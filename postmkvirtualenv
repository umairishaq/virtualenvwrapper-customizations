#!/bin/bash
# This hook is sourced after a new virtualenv is activated.

REQUIREMENTS_FILE=requirements.txt
VENV_FILE_EXTENSION=.venv
REQUIREMENTS_SOURCE=$WORKON_HOME/virtualenvwrapper-customizations
PROJECT_LINK=$VIRTUAL_ENV/$VIRTUALENVWRAPPER_PROJECT_FILENAME

if [[ -f "$PROJECT_LINK" ]]; then
	PROJECT_FOLDER=$(cat $PROJECT_LINK)

	if [[ -n $VIRTUAL_ENV && -n $VIRTUALENVWRAPPER_PROJECT_FILENAME ]]; then
			VENV_FILE_LOCATION=$PROJECT_FOLDER/$VENV_FILE_EXTENSION
			echo $(basename $VIRTUAL_ENV) > $VENV_FILE_LOCATION
	fi

	if [[ -n $PROJECT_FOLDER && ! -f "$PROJECT_FOLDER/$REQUIREMENTS_FILE" ]]; then
		if [ -f "$REQUIREMENTS_SOURCE/$REQUIREMENTS_FILE" ]; then
			cp $REQUIREMENTS_SOURCE/$REQUIREMENTS_FILE $PROJECT_FOLDER/
		else
			touch $PROJECT_FOLDER/$REQUIREMENTS_FILE
		fi

		pip install -r $PROJECT_FOLDER/$REQUIREMENTS_FILE
	fi
fi

